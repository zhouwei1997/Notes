# OSI网络模型和TCP协议

[TOC]

## OSI网络模型

![image-20220514210304743](https://raw.githubusercontent.com/zhouwei1997/Image/master/202205142103994.png)

### OSI模型

- 开放系统互连参考模型，是国际标准化组织（ISO）和国际电报电话咨询委员会（CCITT）联合指定的开放系统互联参考模型
- 目的是为开放式互联信息系统提供了一种功能结构的框架和参考
- OSI一共分为七层：
    - 物理层
    - 数据链路层
    - 网络层
    - 传输层
    - 会话层
    - 表示层
    - 应用层

### OSI七层介绍

#### 应用层

- 应用层是计算机用户，以及各种应用程序和网络之间的接口，其功能是直接向用户提供服务，完成用户希望在网络上完成的各种工作
- 应用层为用户提供的服务和协议：FTP、SSH、网络管理服务等
- 主要功能
    - 用户接口：应用层是用户与网络，以及应用程序与网络间的直接接口，使得用户能够与网络进行交互式联系
    - 实现各种服务：该层具有各种应用程序可以完成和实现用户请求的各种服务

#### 表示层

- 表示层是对来自应用层的命令和数据进行解释，对各种语法赋予相应的含义，并按照一定的格式传送给会话层
- 其主要功能是处理用户信息的表示问题
- 具体功能：
    - 数据格式处理：协商和建立数据交换的格式，解决各应用程序质检在数据格式表示上的差异
    - 数据的编码：处理字符集和数字的转换
    - 压缩和解压缩：为了减少数据的传输量，这一层还负责数据的压缩和解压缩
    - 数据的加密和解密：提高网络的安全性

#### 会话层

- 会话层是用户应用程序和网络之间的接口，主要任务是：组织和协调两个会话进程之间的通信，并对数据交换进行管理
- 当建立会话时，用户必须提供他们想要连接的远程地址
- 具体功能：
    - 会话管理：允许用户在两个实体设备之间建立、维持和终止会话，并支持他们之间的数据交换
    - 会话流量控制：提供会话流量控制和交叉会话功能
    - 寻址：使用远程地址建立会话连接
    - 差错控制：从逻辑上讲会话层主要负责数据交换的建立、保持和终止。当实际的工作时接收来之传输层的数据，并负责纠正错误。
    
#### 传输层

- OSI上三层：应用层、表示层、会话层的主要任务是数据处理——资源子网
- OSI下三层：网络层、数据链路层、物理层的主要任务是数据通讯——通讯子网
- 传输层是OSI的第四层，它是通讯子网和资源子网的接口和桥梁，
- 传输层的主要任务是：向用户提供可靠的端到端的差错和流量控制，保证报文的正确传输
    - 报文：网络交换与传输的数据单元
    - 报文段：组成报文的每个分组

#### 网络层

- 主要任务：数据链路层的数据在这一层被转换为数据包，然后通过路径选择、分段组合、顺序、进出路由等控制，将信息从一个网络设备传送到另一个网络设备
- 一般情况下，数据链路层是解决同一网络（局域网）内节点之间的通信，而网络层主要是解决不同子网间的通信

#### 数据链路层

- 主要功能：在物理层提供的比特流的基础上，通过差错控制、流量控制方法，使有差错的物理线路变成无差错的数据链路，即*向网络层提供可靠的通过物理介质传输数据的方法*。包括LLC子层和MAC子层
  - LLC子层的主要功能：
      - 传输可靠性保障和控制
      - 数据包的分段和重组
      - 数据包的顺序传输
  - MAC子层的主要功能：
      - 数据帧的封装与解封装
      - 帧的寻址和识别，帧的接收与发送，链路的管理，帧的差错控制等
      - MAC子层的存在屏蔽了不同物理链路种类的差异性

- 具体工作：接收来自我路层的位流（比特流）形式的数据，通过差错控制等方法传到网络层；同样也将来自上层的数据，封装成帧转发到物理层；并且，还负责处理接收端发回的确认帧的信息，以便提供可靠的数据传输

#### 物理层

- 利用传输介质作为数据链路层提供物理连接，实现比特流的透明传输。尽可能屏蔽掉具有传输介质和物理设备的差异

### 总结

- OSI模型是一个理想的模型，因此一般网络系统只涉及到其中的几层，很少有系统能够具有所有的7层，并完全遵循它的规定
- 在7层模型中，每一层都提供一个特殊的网络功能
- 从网络功能的角度观察：
    - 物理层、数据链路层、网络层：主要提供数据传输和交换功能，即节点到节点质检的通信为主
    - 传输层：作为上下两部分的桥梁，是整个网络体系结构中最关键的部分
    - 会话层、表示层和应用层：以提供用户和应用程序之间的信息和数据处理功能为主

## TCP/IP协议模型

- TCP/IP协议模型，包含了一系列构成互联网基础的网络协议，是Internet的核心协议
- TCP/IP协议簇是一组不同层次上的多个协议的组合，该协议采用了4层的层级结构，每一层都呼叫它的下一层所提供的协议来完成自己的需求，与OSI的七层模型相对应

### TCP/IP的分层结构

![image-20220514211448673](https://raw.githubusercontent.com/zhouwei1997/Image/master/202205142114760.png)

#### 链路层

- 对应OSI模型的物理层和数据链路层
- ARP（地址解析协议ip-MAC）和RARP（逆向地址解析协议MAC-IP）是某些网络接口（如以太网）使用的特殊协议，用来转换IP层和网络接口层使用的地址

#### 网络层

- OSI网络层
- 也称作互联网层或网际层，处理分组在网络中的活动，例如分组的选路
- 在TCP/IP协议族中，网络层协议包括IP协议，ICMP协议（Internet互联网控制报文协议），IGMP协议（Internet组管理协议）
    - IP是一种网络层协议，提供的是一种不可靠服务，它只是尽可能快的把分组从源节点送到目的节点，但是并不是提供如何可靠性保证。同时被TCP和UDP使用
    - TCP和UDP的每组数据都跳过端系统和每个中间路由器中的IP层在互联网中进行传输
    - ICMP是IP协议的附属协议。IP层用它来与其他主机或路由器交换错误报文和其他重要信息。他主要是用来提供有关通向目的地址的路径信息
    - IGMP是Internet组管理协议。他用来把一个UDP数据报多播到多个主机。该协议运行在主机和组播路由器之间

#### 运输层

- OSI传输层
- 主要为两台主机上的应用程序提供端到端的通信。在TCP/IP协议簇中，有两个互不相同的传输协议
    - TCP传输控制协议
        - 为两台主机提供高可靠性的数据通信。TCP是面向连接的通信协议，通过三次握手建立连接，通讯完成时断开连接，由于TCP是面向连接的所以只能用于端到端的头。
        - TCP提供一种可靠的数据流服务，采用带重传的肯定确认技术来实现传输的可靠性。也就是TCP数据包中包括序号（seq）和确认（ack）。因此未按照顺序接收到的包可以被排序，而损坏的包可以被重传
    - UDP用户数据报协议
        - UDP为应用层提供一种非常简单的服务。他是面向无连接的通讯协议，UDP数据包括目的端口号和源端口号学校，由于通讯不需要连接，所以可以实现广播发送
        - UDP通讯时不需要接收方确认，不保证该数据报能到达另一端，属于不可靠的传输，可能会出现丢包现象。UDP和TCP位于同一层，但它不管数据包的顺序、错误或重发-

#### 应用层

- OSI会话层、表示层、应用层
- 负责处理特定的应用程序细节

### 数据封装过程

- 数据格式：
    - TCP数据信息：TCP头部+实际数据（TCP头包括源和目的主机端口号、顺序号、确认号、校验字等）
    - IP数据包：IP头部+TCP数据信息（IP头包括源和目的主机IP地址、类型、生存期等）
    - 数据帧：帧头+IP数据包+帧尾（帧头包括源和目的主机MAC初步地址及类型。帧尾是校验字）
- 数据的封装和解封装
    - 封装：数据要通过网络进行传输，要从高层一层一层的向下传送，如果一个主机要传送数据到别的主机，先把数据装到一个特殊协议报头中，这个过程要封装
    - 解封装：封装的逆过程

![image-20220514214226124](https://raw.githubusercontent.com/zhouwei1997/Image/master/202205142142215.png)



## TCP/IP三次握手和四次断开

![image-20220514214308153](https://raw.githubusercontent.com/zhouwei1997/Image/master/202205142143247.png)



